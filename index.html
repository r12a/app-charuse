<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Character usage</title>
<meta name="description" content="Characters used by any particular language, and languages which use any particular character." />
<link rel="stylesheet" type="text/css" href="../shared/style/docs.css" />
<link rel="stylesheet" type="text/css" href="style.css" />
<script type="text/javascript" src="../shared/code/boilerplate.js"></script>
<script type="text/javascript" src="../shared/code/all-names.js"></script>
<script type="text/javascript" src="../shared/code/scriptGroups.js"></script>
<script type="text/javascript" src="char_lang.js"></script>
<script type="text/javascript" src="langs.js"></script>
<script>

function makeBCPList () {
	//out = '<option value=""> </option>'
	out = ''
	array = []
	for (l in langs) array.push(l)
	array.sort()
	for (let i=0;i<array.length;i++) out += '<option value="'+array[i]+'">'+array[i]+' '+langs[array[i]].name+'</option>\n'
	document.getElementById('totalLanguages').textContent = array.length
	document.getElementById('total').textContent = array.length
	return out
	}

function makeLangList () {
	out = ''
	for (l in langs) out += '<option value="'+l+'">'+langs[l].name+'</option>\n'
	return out
	}

function listLangsByRegion () {
    var regionList = { eur:[], wasia:[], casia:[], sasia:[], seasia:[], nasia:[], easia:[], afr:[], oce:[], carib:[], sam:[], cam:[], nam:[] }
    for (l in langs) {
        var language = Object.assign({bcp:l}, langs[l])
        regionList[langs[l].region].push(language)
        }
	out = ''
	for (r in regionList) {
        switch (r) {
            case 'afr': region = 'Africa';break
            case 'oce': region = 'Oceania';break
            case 'eur': region = 'Europe';break
            case 'nam': region = 'Northern America';break
            case 'cam': region = 'Central America';break
            case 'sam': region = 'South America';break
            case 'wasia': region = 'Western Asia';break
            case 'casia': region = 'Central Asia';break
            case 'nasia': region = 'Northern Asia';break
            case 'sasia': region = 'South Asia';break
            case 'seasia': region = 'South East Asia';break
            case 'easia': region = 'East Asia';break
            case 'carib': region = 'Caribbean';break
            }
        out += '<tr><th>'+region+'</th><td>'+regionList[r].length+' languages: '
        for (let l=0;l<regionList[r].length;l++ ) {
           out += '<span onclick="showLanguage(\''+regionList[r][l].bcp+'\')">'+regionList[r][l].name.replace(/ \([^\)]+\)/g,'')+'</span>, '
            }
        out += '</td></tr>'
        }
	return out
	}
// regions:
// nam (Northern America), sam (South America), cam (Central America), carib (Caribbean)
// eur (Europe - includes Russia to Urals and Georgia, but not Armenia or Azerbaijan)
// easia (East Asia - includes China, Mongolia, Japan, Korea)
// nasia (Northern Asia - Russia east of Urals)
// seasia (Southeast Asia - including Indonesia, Philippines
// casia (Central Asia - north of Iran, S of Russia, W of China)
// wasia (Western Asia - includes Armenian, Azerbaijan, Turkey, & middle east)
// afr (Africa)
// oce (Oceania - includes Australia, NZ, and Pacific Islands)


function listLangsByScript () {
    // code to find out what script tags are there
    //var myset = new Set([])
    //for (l in langs) {
    //    if (myset.has(langs[l].script)) { }
    //    else myset.add(langs[l].script)
    //    }
    //console.log(myset)

    var regionList = { ascii:[], adlm:[], arab:[], armn:[], bali:[], bamu:[], beng:[], bugi:[], cans:[], cakm:[], cher:[], cyrl:[], deva:[], ethi:[], geor:[], grek:[], gujr:[], guru:[], hebr:[], java:[], knda:[], khmr:[], laoo:[], latn:[], lisu:[], mlym:[], mand:[], mymr:[], talu:[], nkoo:[], orya:[], sinh:[], sund:[], syrc:[], syrn:[], tale:[], lana:[], tavt:[], taml:[], telu:[], thaa:[], thai:[], tibt:[], tfng:[], vaii:[], yiii:[], macrolanguage:[] }
    for (l in langs) {
        var language = Object.assign({bcp:l}, langs[l])
        regionList[langs[l].script].push(language)
        }
	out = ''
	for (r in regionList) {
        switch (r) {
            case 'ascii': region = 'ASCII only';break
            case 'adlm': region = 'Adlam';break
            case 'arab': region = 'Arabic';break
            case 'armn': region = 'Armenian';break
            case 'bali': region = 'Balinese';break
            case 'bamu': region = 'Bamum';break
            case 'beng': region = 'Bengali';break
            case 'bugi': region = 'Buginese';break
            case 'cakm': region = 'Chakma';break
            case 'cans': region = 'Canadian Syllabics';break
            case 'cher': region = 'Cherokee';break
            case 'cyrl': region = 'Cyrillic';break
			case 'deva': region = 'Devanagari';break
            case 'ethi': region = 'Ethiopic';break
            case 'geor': region = 'Georgian';break
            case 'grek': region = 'Greek';break
            case 'gujr': region = 'Gujarati';break
            case 'guru': region = 'Gurmukhi';break
            case 'hebr': region = 'Hebrew';break
            case 'java': region = 'Javanese';break
            case 'knda': region = 'Kannada';break
            case 'khmr': region = 'Khmer';break
            case 'lana': region = 'Tai Tham';break
            case 'laoo': region = 'Lao';break
            case 'latn': region = 'Latin';break
            case 'lisu': region = 'Lisu';break
            case 'mand': region = 'Mandaic';break
            case 'mlym': region = 'Malayalam';break
            case 'mymr': region = 'Myanmar';break
            case 'orya': region = 'Oriya';break
            case 'nkoo': region = 'NKo';break
            case 'sinh': region = 'Sinhala';break
            case 'sund': region = 'Sundanese';break
            case 'syrc': region = 'Syriac';break
            case 'syrn': region = 'Eastern Syriac';break
            case 'tfng': region = 'Tifinagh';break
            case 'taml': region = 'Tamil';break
            case 'tavt': region = 'Tai Viet';break
            case 'tale': region = 'Tai Le';break
            case 'talu': region = 'New Tai Lü';break
            case 'telu': region = 'Telugu';break
            case 'thai': region = 'Thai';break
            case 'thaa': region = 'Thaana';break
            case 'tibt': region = 'Tibetan';break
            case 'vaii': region = 'Vai';break
            case 'yiii': region = 'Yi';break
            case 'macrolanguage': region = 'Macrolanguage';break
            }
        out += '<tr><th>'+region+'</th><td>'+regionList[r].length+' languages: '
        for (let l=0;l<regionList[r].length;l++ ) {
           out += '<span onclick="showLanguage(\''+regionList[r][l].bcp+'\')">'+regionList[r][l].name.replace(/ \([^\)]+\)/g,'')+'</span>'
           if (l<regionList[r].length-1) out += ', '
            }
        out += '</td></tr>'
        }
	return out
	}


function findChars (str) {
	//str.replace(/[\s]+/g,'')
	str = convertEscapes(str)
	var chars = [...str]
	var out = ''
	for (i=0;i<chars.length;i++){
		cp = chars[i].codePointAt(0)
		if (cp>127) {
			out += '<tr><th>'+chars[i]+'</td>'
			if (cl[cp]) {
				out += '<td>'
				languages = cl[cp][0]
				auxlanguages = cl[cp][1]
				var languageNames = ''
				var population = 0
				for (let l=0;l<languages.length;l++) {
					//languageNames += langs[languages[l]].name.replace(/ \([^\)]+\)/g,'')
					languageNames += '<span onclick="showLanguage(\''+languages[l]+'\')">'+langs[languages[l]].name.replace(/ \([^\)]+\)/g,'')+'</span>'
					if (l<languages.length-1) languageNames += ', '
					speakerNum = langs[languages[l]].speakers.replace(/~/,'')
					speakerNum = speakerNum.replace(/\?/,'0')
					population += parseInt(speakerNum)
					}
                if (languages.length>0 && auxlanguages.length>0) languageNames += ', '
				for (let l=0;l<auxlanguages.length;l++) {
					//languageNames += langs[languages[l]].name.replace(/ \([^\)]+\)/g,'')
					languageNames += '<span style="font-style:italic" onclick="showLanguage(\''+auxlanguages[l]+'\')">'+langs[auxlanguages[l]].name.replace(/ \([^\)]+\)/g,'')+'</span>'
					if (l<auxlanguages.length-1) languageNames += ', '
					speakerNum = langs[auxlanguages[l]].speakers.replace(/~/,'')
					speakerNum = speakerNum.replace(/\?/,'0')
					population += parseInt(speakerNum)
					}
				//out += languageNames+' ('+languages.length+' languages)</td>'
                totallanguages = languages.length+auxlanguages.length
				out += totallanguages+' languages: '+languageNames+'</td>'
				out += '<td>'+population.toLocaleString('en')+'</td>'
				}
			else out += '<td>Unknown</td><td>-</td>'
			out += '</tr>'
			}
		}
	return out
	}


function getAll (which) { 
	// copies characters to clipboard when you click on the stats
	if (which === 'total') {
		out = ''
		if (document.getElementById('letterCell')) out += document.getElementById('letterCell').textContent
		if (document.getElementById('markCell')) out += document.getElementById('markCell').textContent
		if (document.getElementById('punctuationCell')) out += document.getElementById('punctuationCell').textContent
		if (document.getElementById('numberCell')) out += document.getElementById('numberCell').textContent
		if (document.getElementById('symbolCell')) out += document.getElementById('symbolCell').textContent
		out = out.replace(/\s+/g,'')
		}
	else {
		out = document.getElementById(which).textContent
		out = out.replace(/\s+/g,'')
		}
	
	document.getElementById('clipboardStore').value = out
	
	document.getElementById('clipboardStore').focus()
	document.getElementById('clipboardStore').select()
	document.execCommand('copy')
	}



function showLanguage (lang) {
	out = ''
	var charList
    var stats = 'Non-ASCII character count: &nbsp; '
    var total = 0

	// check this is a valid langtag
	if (!langs[lang]) { alert("The tag "+lang+" was not recognised."); return }
	
	if (langs[lang].silcode) langcode = langs[lang].silcode
	else langcode = lang

	out += '<tr><td colspan="2" class="links" style="text-align:right; padding: 0; font-size: 80%; vertical-align:bottom;"><span style="cursor:pointer; margin-right:1em; color:teal;" onclick="toImg(document.getElementById(\'letterCell\')); toImg(document.getElementById(\'markCell\')); toImg(document.getElementById(\'punctuationCell\')); toImg(document.getElementById(\'numberCell\')); toImg(document.getElementById(\'infrequentCell\')); toImg(document.getElementById(\'symbolCell\')); this.style.color=\'#ccc\';">Convert to images</span></td><td class="links" style="padding:0;">&nbsp;</td></tr>'
	
	// name
	out += '<tr><th>Name</th><td class="large">'+langs[lang].name+'&nbsp; <a href="../app-subtags/?lookup='+lang+'" target="_blank" style="font-size:80%;">['+lang+']</a>'+'&nbsp; <span class="scriptName" style="font-size:60%;">'+langs[lang].script+'</span></td><td class="links"><a href="https://en.wikipedia.org/w/index.php?search='+langs[lang].name+'%20language" target="_blank"><img src="wikipedia.png" alt="Search Wikipedia for this language" title="Search Wikipedia for this language" /></a></td></tr>'

	if (!langs[lang].redirect) {
	
	// local name
	if (langs[lang].local) out += '<tr><th>Autonym</th><td class="localCell">'+langs[lang].local+'</td></td><td class="links"></td></tr>'
	
	if (langs[lang].rtl) rtl = true
	else rtl = false
	
	// characters
	if (langs[lang].letter) {
		charList = [...langs[lang].letter]
		charList.sort()
        stats += charList.length + ' <a onclick="getAll(\'letterCell\');return false;" style="cursor:pointer;">letters</a>'
        total += charList.length
		out += '<tr><th>Letters</th><td class="large" id="letterCell"'
		if (rtl) out += ' dir="rtl">'
		else out += '>'
		for (j=0;j<charList.length;j++) { 
			cp = charList[j].codePointAt(0).toString(16).toUpperCase()
			while (cp.length<4) cp = '0'+cp
			name = 'U+'+cp+' '+charData[charList[j]]
			out += '<span title="'+name+'">'+charList[j]+'</span> ' 
			}
		out += '</td><td class="links"><a href="/uniview?charlist='+charList.join('')+'" target="_blank"><img src="univ.png" alt="Show characters in UniView." title="Show characters in UniView." class="ulink"/></a></td></tr>'
		}
	if (langs[lang].mark) {
		charList = [...langs[lang].mark]
 		charList.sort()
        if (total > 0) stats += ', '
        stats += charList.length + ' <a onclick="getAll(\'markCell\');return false;" style="cursor:pointer;">marks</a>'
        total += charList.length
		out += '<tr><th>Marks</th><td class="large" id="markCell"'
		if (rtl) out += ' dir="rtl">'
		else out += '>'
		for (j=0;j<charList.length;j++) { 
			cp = charList[j].codePointAt(0).toString(16).toUpperCase()
			while (cp.length<4) cp = '0'+cp
			name = 'U+'+cp+' '+charData[charList[j]]
			out += '<span title="'+name+'">'+'\u00A0'+charList[j]+'</span> ' 
			}
		out += '</td><td class="links"><a href="/uniview?charlist='+charList.join('')+'" target="_blank"><img src="univ.png" alt="Show characters in UniView."  title="Show characters in UniView." class="ulink"/></a></td></tr>'
		}
	if (langs[lang].punctuation) {
		charList = [...langs[lang].punctuation]
 		charList.sort()
        if (total > 0) stats += ', '
        stats += charList.length + ' <a onclick="getAll(\'punctuationCell\');return false;" style="cursor:pointer;">punctuation</a>'
        total += charList.length
		out += '<tr><th>Punctuation</th><td class="large" id="punctuationCell"'
		if (rtl) out += ' dir="rtl">'
		else out += '>'
		for (j=0;j<charList.length;j++)  { 
			cp = charList[j].codePointAt(0).toString(16).toUpperCase()
			while (cp.length<4) cp = '0'+cp
			name = 'U+'+cp+' '+charData[charList[j]]
			out += '<span title="'+name+'">'+'\u00A0'+charList[j]+'</span> ' 
			}
		out += '</td><td class="links"><a href="/uniview?charlist='+charList.join('')+'" target="_blank"><img src="univ.png" alt="Show characters in UniView." title="Show characters in UniView." class="ulink"/></a></td></tr>'
		}
	if (langs[lang].number) {
		charList = [...langs[lang].number]
        if (total > 0) stats += ', '
        stats += charList.length + ' <a onclick="getAll(\'numberCell\');return false;" style="cursor:pointer;">numbers</a>'
        total += charList.length
		out += '<tr><th>Numbers</th><td class="large" id="numberCell"'
		if (rtl) out += ' dir="rtl">'
		else out += '>'
		for (j=0;j<charList.length;j++)  { 
			cp = charList[j].codePointAt(0).toString(16).toUpperCase()
			while (cp.length<4) cp = '0'+cp
			name = 'U+'+cp+' '+charData[charList[j]]
			out += '<span title="'+name+'">'+'\u00A0'+charList[j]+'</span> ' 
			}
		out += '</td><td class="links"><a href="/uniview?charlist='+langs[lang].number+'" target="_blank"><img src="univ.png" alt="Show characters in UniView." title="Show characters in UniView." class="ulink"/></a></td></tr>'
		}
	if (langs[lang].symbol) {
		charList = [...langs[lang].symbol]
        if (total > 0) stats += ', '
        stats += charList.length + ' <a onclick="getAll(\'symbolCell\');return false;" style="cursor:pointer;">symbols</a>'
        total += charList.length
		out += '<tr><th>Symbols</th><td class="large" id="symbolCell"'
		if (rtl) out += ' dir="rtl">'
		else out += '>'
		for (j=0;j<charList.length;j++)  { 
			cp = charList[j].codePointAt(0).toString(16).toUpperCase()
			while (cp.length<4) cp = '0'+cp
			name = 'U+'+cp+' '+charData[charList[j]]
			out += '<span title="'+name+'">'+'\u00A0'+charList[j]+'</span> ' 
			}
		out += '</td><td class="links"><a href="/uniview?charlist='+langs[lang].symbol+'" target="_blank"><img src="univ.png" alt="Show characters in UniView." title="Show characters in UniView." class="ulink"/></a></td></tr>'
		}
	if (langs[lang].other) {
		charList = [...langs[lang].other]
        if (total > 0) stats += ', '
        stats += charList.length + ' other'
        total += charList.length
		out += '<tr><th>Other</th><td class="other" id="otherCell">'
		//out += langs[lang].other
		for (j=0;j<charList.length;j++)  { 
			cp = charList[j].codePointAt(0).toString(16).toUpperCase()
			while (cp.length<4) cp = '0'+cp
			name = 'U+'+cp+' '+charData[charList[j]]
			out += '<span title="'+name+'">U+'+cp+'</span> ' 
			}
		//for (j=0;j<charList.length;j++) out += charList[j].codepointAt(0)+' '
		out += '</td><td class="links"><a href="/uniview?charlist='+langs[lang].other+'" target="_blank"><img src="univ.png" alt="Show characters in UniView." title="Show characters in UniView." class="ulink"/></a></td></tr>'
		}
			
	// stats
	stats += ' : &nbsp; <a onclick="getAll(\'total\');return false;" style="cursor:pointer;">total</a> ' + total
	if (langs[lang].aux || langs[lang].deprecated) stats += ' &nbsp; &nbsp; + ( '
	if (langs[lang].aux) {
		charList = [...langs[lang].aux]
        stats += charList.length + ' <a onclick="getAll(\'infrequentCell\');return false;" style="cursor:pointer;">infrequent</a> '
		out += '<tr><th>Infrequent</th><td class="small" id="infrequentCell"'
		if (rtl) out += ' dir="rtl">'
		else out += '>'
		for (j=0;j<charList.length;j++) { 
			cp = charList[j].codePointAt(0).toString(16).toUpperCase()
			while (cp.length<4) cp = '0'+cp
			name = 'U+'+cp+' '+charData[charList[j]]
			out += '<span title="'+name+'">'+'\u00A0'+charList[j]+'</span> ' 
			}
		out += '</td><td class="links"><a href="/uniview?charlist='+langs[lang].aux+'" target="_blank"><img src="univ.png" alt="Show characters in UniView."  title="Show characters in UniView." class="ulink"/></a></td></tr>'
		}
	if (langs[lang].deprecated) {
		charList = [...langs[lang].deprecated]
        if (total > 0) stats += ', '
        stats += charList.length + ' deprecated'
        total += charList.length
		out += '<tr><th>Deprecated</th><td class="small"'
		if (rtl) out += ' dir="rtl">'
		else out += '>'
		for (j=0;j<charList.length;j++)  { 
			cp = charList[j].codePointAt(0).toString(16).toUpperCase()
			while (cp.length<4) cp = '0'+cp
			name = 'U+'+cp+' '+charData[charList[j]]
			out += '<span title="'+name+'">'+'\u00A0'+charList[j]+'</span> ' 
			}
		out += '</td><td class="links"><a href="/uniview?charlist='+langs[lang].symbol+'" target="_blank"><img src="univ.png" alt="Show characters in UniView." title="Show characters in UniView." class="ulink"/></a></td></tr>'
		}
	if (langs[lang].aux || langs[lang].deprecated) stats += ' )'
	if (!langs[lang].letter && !langs[lang].mark && !langs[lang].punctuation && !langs[lang].number && !langs[lang].symbol && !langs[lang].other) {
		out += '<tr><th></th><td class="large">ASCII only</td></tr>'
		stats = ''
		}
	else stats = '<tr><th></th><td style="border:0; font-size: 70%; font-style: italic; line-height: 1; color:gray;">'+stats+'  <input  id="clipboardStore" style="height:2px;width:2px;margin-left:2em;vertical-align:middle;"/></td></tr>'

	// source
	var sources = langs[lang].source.split(',')
	// check whether there is only a UDHR source
	if (sources.length === 1 && sources[0].match('udhr_')) var warning = true
	else warning = false
	out += '<tr><th>Sources</th><td class="sources">'
	for (let i=0;i<sources.length;i++) {
		if (i>0) out += ', '
		if (sources[i].startsWith('cldr_')) out += '<a href="https://www.unicode.org/cldr/charts/latest/summary/'+sources[i].substr(5)+'.html">CLDR</a>'
		else if (sources[i].startsWith('udhr_')) out += '<a href="https://unicode.org/udhr/d/'+sources[i]+'.html">UDHR</a>'
		else if (sources[i].startsWith('ethn_')) out += '<a href="https://ethnologue.com/language/'+sources[i].substr(5)+'">Ethnologue</a>'
		else if (sources[i].startsWith('http')) out += '<a href="'+sources[i]+'">link</a>'
		else if (sources[i] === 'r12a' || sources[i] === 'CLDR' || sources[i] === 'UDHR') out += sources[i]
		else out += '<a href="https://github.com/r12a/app-charuse/commit/'+sources[i]+'">GitHub</a>'
		}
	if (warning) out += '<br/><span class="udhrWarning">The sole source for this language is the translation of the Universal Declaration of Human Rights. That text may not contain all characters needed for this orthography.</span>'
	out += '</td></td><td class="links"></tr>'
	
	out += stats
	
	// region
	switch (langs[lang].region) {
		case 'afr': region = 'Africa';break
		case 'oce': region = 'Oceania';break
		case 'eur': region = 'Europe';break
		case 'nam': region = 'Northern America';break
		case 'cam': region = 'Central America';break
		case 'sam': region = 'South America';break
		case 'wasia': region = 'Western Asia';break
		case 'casia': region = 'Central Asia';break
		case 'nasia': region = 'Northern Asia';break
		case 'sasia': region = 'South Asia';break
		case 'seasia': region = 'South East Asia';break
		case 'easia': region = 'East Asia';break
		case 'carib': region = 'Caribbean';break
		}
	out += '<tr><th>Region</th><td>'+region
	if (langs[lang].countries) out += '<span class="countries">'+langs[lang].countries+'</span>'
	out += '</td></td><td class="links"><a href="https://www.ethnologue.com/language/'+langcode+'" target="_blank"><img src="ethn.png" alt="Look this up in the Ethnologue." title="Look this up in the Ethnologue." class="ulink"/></a></td></tr>'
	
	// speakers
	if (langs[lang].speakers === '?') var speakers = 'Not known'
	else { 
		speakers = langs[lang].speakers.replace(/~/,'')
		speakers = parseInt(speakers).toLocaleString('en')
		}
	//speakers = speakers.replace(/\?/,'0')
	out += '<tr><th>Native speakers</th><td>'+speakers+'</td></tr>'
	} // ends stuff cut out for macrolanguages etc.
	
	// local name
	//if (langs[lang].local) out += '<tr><th>Autonym</th><td class="localCell">'+langs[lang].local+'</td></td><td class="links"></td></tr>'
	
	// notes
	if (langs[lang].notes) {
		langs[lang].notes = langs[lang].notes.replace(/\[/g, '<i>')
		langs[lang].notes = langs[lang].notes.replace(/\]/g, '</i>')
	
		lines = langs[lang].notes.split('\n')
		inList = false
		for (let l=0;l<lines.length;l++) {
			if (lines[l].startsWith('*')) {
				if (inList) lines[l] = '<li>'+lines[l].substring(2)+'</li>'
				else {
					lines[l] = '<ul><li>'+lines[l].substring(2)+'</li>'
					inList = true
					}
				}
			else if (inList) {
				lines[l] = '</ul><p>'+lines[l]+'</p>'
				inList = false
				}
			else lines[l] = '<p>'+lines[l]+'</p>'
			}
		formattedNote = lines.join('')
		out += '<tr><th>Notes</th><td class="notesCell">'+formattedNote+'</td></td><td class="links"></td></tr>'
		}
	
	// related
	if (langs[lang].related) {
		langs[lang].related = langs[lang].related.replace(/\[/g, '<i>')
		langs[lang].related = langs[lang].related.replace(/\]/g, '</i>')
	
		lines = langs[lang].related.split('\n')
		inList = false
		for (let l=0;l<lines.length;l++) {
			if (lines[l].startsWith('*')) {
				if (inList) lines[l] = '<li>'+lines[l].substring(2)+'</li>'
				else {
					lines[l] = '<ul><li>'+lines[l].substring(2)+'</li>'
					inList = true
					}
				}
			else if (inList) {
				lines[l] = '</ul><p>'+lines[l]+'</p>'
				inList = false
				}
			else lines[l] = '<p>'+lines[l]+'</p>'
			}
		formattedNote = lines.join('')
		out += '<tr><th>Related</th><td class="notesCell">'+formattedNote+'</td></td><td class="links"></td></tr>'
		}


	document.getElementById('langDetails').innerHTML = out
	

	// put links around tags related to macrolanguages
	var macrolist = document.querySelectorAll('i')
	for (let i=0;i<macrolist.length;i++) {
		var finalList = ''
		var tagList = macrolist[i].textContent.split(' ')
		for (let t=0;t<tagList.length;t++) {
			if (t>0) finalList = ' '+finalList
			if (langs[tagList[t]]) finalList += '<a href="./?language='+tagList[t]+'">'+tagList[t]+'</a>'
			else finalList += tagList[t]
			}
		macrolist[i].innerHTML = finalList
		}
	}


function convertEscapes ( str ) { 
	// converts a string containing hex escapes of various kinds to a string of characters
	// and strips white space
	// str: string, the input and output
	
	// replace the escape syntax chars with spaces
	str = str.replace(/0x/g, ' ')
	str = str.replace(/[&#x;\\{}Uu+]/g, ' ')
	
	// first convert the 6 digit escapes to characters
	str = str.replace(/10([A-Fa-f0-9]{4})/g, 
					function(matchstr, parens) {
						return String.fromCodePoint(parseInt('10'+parens,16));
						}
						); 
	
	// next convert up to 5 digit escapes to characters
	str = str.replace(/([A-Fa-f0-9]{1,5})/g, 
					function(matchstr, parens) {
						return String.fromCodePoint(parseInt(parens,16));
						}
						); 
	return str.replace(/\s/g,'');
	}

function compareLists () {
    var left = document.getElementById('leftList').value
    var right = document.getElementById('rightList').value
    
    var leftArray = [...left]
    var rightArray = [...right]
    
    var leftResult = ''
    var rightResult = ''
    
    for (let i=0;i<leftArray.length;i++) {
        var found = false
        for (let j=0;j<rightArray.length;j++) {
            if (leftArray[i] === rightArray[j]) { found = true; break }
            }
        if (! found) leftResult += leftArray[i]
        }
    document.getElementById('leftOut').textContent = leftResult

    for (let i=0;i<rightArray.length;i++) {
        var found = false
        for (let j=0;j<leftArray.length;j++) {
            if (rightArray[i] === leftArray[j]) { found = true; break }
            }
        if (! found) rightResult += rightArray[i]
        }
    document.getElementById('rightOut').textContent = rightResult

    }


function xfilter (str) {
	str = str.toLowerCase()
	str = str.replace(/ /,'.*')
	var total = 0
	var names = document.querySelectorAll('#listrecord p')
	for (var i=0;i<langs.length;i++) {
		if (! langs[i].name.toLowerCase().match(str)) names[i].style.display = 'none'
		else { names[i].style.display = 'block'; total++ }
		}
	document.getElementById('total').textContent = total
	}

function filter (str) {
	str = str.toLowerCase()
	str = str.replace(/ /,'.*')
	var total = 0
	var names = document.querySelectorAll('#languageSelector option')
	for (var i=0;i<names.length;i++) {
		if (! names[i].textContent.toLowerCase().match(str)) names[i].style.display = 'none'
		else { names[i].style.display = 'block'; total++ }
		}
	document.getElementById('total').textContent = total
	}


function findScriptGroup ( charNum ) { 
	// output: returns the name of the script group in which charNum falls
	// charNum: a decimal number representing the code point of the character in question
	if (charNum < 128) { return 'Basic Latin' }
	var i=1
	while ( i<scriptGroups.length && charNum > scriptGroups[i][0] ) i++
	if ( i === scriptGroups.length ) { return( "Not a character!" ) }
	if ( scriptGroups[i-1][1] >= charNum ) { return( scriptGroups[i-1][2]) }
	if ( scriptGroups[i][0] == charNum ) { return( scriptGroups[i][2]) }
	return( "Not a character!" )
	}

function toImg (node) {
	// convert the characters shown to images
	
	if (! node) return
	
	var charlist = node.textContent.replace(/\s+/g,'')
	//console.log(charlist)
	var charArray = [...charlist]
	//console.log(charArray)
	var out = ''
	for (let i=0;i<charArray.length;i++) {
		cp = charArray[i].codePointAt(0)
		scriptGroup = findScriptGroup(cp)
		//console.log(scriptGroup)
		hexNum = cp.toString(16).toUpperCase()
		while (hexNum.length < 4) hexNum = '0'+hexNum
		out += '<img src="../c/'+scriptGroup.replace(/ /g,'_')+'/'+hexNum+'.png"/> '
		}
	//console.log(out)
	node.innerHTML = out
	}


function initialise () {
	document.getElementById('languageSelector').innerHTML = makeBCPList()
	document.getElementById('languageByRegion').innerHTML = listLangsByRegion()
	document.getElementById('languageByScript').innerHTML = listLangsByScript()
	
	// check for parameters and take appropriate action
	parameters = location.search.split('&');
	parameters[0] = parameters[0].substring(1);
	for (var p=0;p<parameters.length;p++) {  
		pairs = parameters[p].split('=');
		if (pairs[0] == 'charlist') { 
			if (pairs[1]) { 
				document.getElementById('characters').value = decodeURIComponent(pairs[1])
				document.getElementById('output').innerHTML = findChars(document.getElementById('characters').value)
				}
			}
		if (pairs[0] === 'language') { 
			if (pairs[1]) { 
				document.getElementById('languageSelector').value = pairs[1]
				showLanguage(pairs[1])
				}
			}
		}
	}
</script>
</head>

<!--body class="app" onLoad="document.getElementById('languageSelector').innerHTML = makeBCPList(); document.getElementById('langNames').innerHTML = makeLangList(); document.getElementById('languageByRegion').innerHTML = listLangsByRegion(); document.getElementById('languageByScript').innerHTML = listLangsByScript()"-->
<!--body class="app" onLoad="document.getElementById('languageSelector').innerHTML = makeBCPList(); document.getElementById('languageByRegion').innerHTML = listLangsByRegion(); document.getElementById('languageByScript').innerHTML = listLangsByScript()"-->
<body class="app" onLoad="initialise()">
<header>
<div id="header-boilerplate"></div>
<script>document.getElementById('header-boilerplate').innerHTML = bp_appHeader('/shared/images/world.gif','Character usage lookup','');</script>
</header>
<!--aside class="sidebar">
<section>
  <p style="font-size: 90%;"><samp>Find a language tag</samp> works for Firefox and Chrome only. For other browsers, <a href="/app-subtags/">find a tag here</a>.</p>
</section>
</aside-->


<p style="font-size: 90%;">Find non-ASCII characters used by a given language, or languages that use a given non-ASCII character. The information may not be 100% reliable. <strong><a href="#notesSection" onClick="document.getElementById('notesSection').open = true;">Please read the notes below.</a></strong></p>


<section style="margin-top: 3em;">
<p style="font-size: 150%; color: #a52a2a;">Find a language</p>

<p>Filter the list <input id="filter" type="text" onInput="filter(this.value);" /> <span style="font-size: 70%; margin-left:2em;">Total: <span id="total"></span></span></p>

<p><label>
<select id="languageSelector" onChange="showLanguage(this.value)" size="5"></select></label><!--br/>
<i style="font-size:80%;">
<label>Find a language tag: 
<input style="width:30em;" list="langNames" id="langNameInput"  onChange="document.getElementById('langDetails').innerHTML = showLanguage(this.value)" placeholder="Type, then select name, then hit return." /></label></i>
<datalist id="langNames"></datalist-->
</p>


<table id="langDetails"></table>
</section>


<section style="margin-top: 5em;">
  <form action="none" onsubmit=" return false;">
  <p style="font-size: 150%; color: #a52a2a;">Look up characters</p>
  <p>
      <input class="inputbox" id="characters" dir="auto" type="text"/>
    </p>
</form>
 
     <p><button style="vertical-align:top;" onclick="document.getElementById('output').innerHTML = findChars(document.getElementById('characters').value)">Look up</button></p>
<table style="margin-top: 3em;margin-right: 3em;">
<thead><th></th><th>Languages (<em>italics</em> indicate infrequent), out of <span id="totalLanguages"></span></th><th>Native speakers</th>
<tbody id="output"><td></td><td></td><td></td></table>
</section>



<!--details style="margin-top: 5em;">
  <summary style="margin-left: 7.5%; cursor: pointer;"><strong>Stats</strong></summary--> 

    <details>
    <summary style="margin-top: 5em; margin-left: 7.5%; cursor: pointer;">Compare lists</summary>
    <div style="margin-left: 7.5%;" id="comparisonInput">
    <div><textarea name="left" id="leftList" cols="30" rows="10"></textarea><p id="leftResult">Characters unique to this side:<br/><span id="leftOut"></span></p></div>
    <div><textarea name="right" id="rightList" cols="30" rows="10"></textarea><p id="rightResult">Characters unique to this side:<br/><span id="rightOut"></span></p></div>
    </div>
    <p><button onClick="compareLists()">Compare</button></p>
    </details>

    <details>
    <summary style="margin-top: 1em; margin-left: 7.5%; cursor: pointer;">Show languages by region</summary>
    <table><tbody id="languageByRegion"></tbody></table>
    </details>

    <details>
    <summary style="margin-top: 1em; margin-left: 7.5%; cursor: pointer;">Show languages by script</summary>
    <table><tbody id="languageByScript"></tbody></table>
    </details>
    
<!--/details-->

<details style="margin-top: 2em;" id="notesSection">
  <summary style="margin-left: 7.5%; cursor: pointer;"><strong>Notes</strong></summary> 

<aside class="sidebar">
  <div class="section">
    <h2 class="flush">Related links</h2>
    <p><a target="_blank" href="https://www.unicode.org/cldr/charts/latest/summary/root.html">CLDR</a></p>
    <p><a target="_blank" href="http://unicode.org/udhr/translations.html">UDHR</a></p>
    <p><a href="https://github.com/r12a/app-charuse/issues/new?title=[app-charuse]%20%20ADD%20TITLE%20HERE">Raise an issue</a></p>
    <p><a href="https://github.com/r12a/app-charuse/issues/">See open issues</a></p>
  </div>
</aside>

<p id="status">Updated Fri 20 Feb 2015  &bull; tags <a href="http://r12a.github.io/blog/index.php?tag=counterstyles" title="Show all blog posts tagged with 'counterstyles'">counterstyles</a>, <a href="http://r12a.github.io/blog/?tag=scriptnotes" title="Show all blog posts tagged with 'scriptnotes'">scriptnotes</a>, <a href="http://r12a.github.io/blog/?tag=apps" title="Show all blog posts tagged with 'apps'">apps</a></p>

<section>
<p>This page allows you to track the correspondences between languages and non-ASCII Unicode characters. The language+script pairs are derived from CLDR and/or the Unicode site's UDHR transcripts, although some characters are added on the basis of other sources. It isn't claimed that this list is exhaustively correct, so you should treat it as an approximation.</p>
</section>

<section>
  <h3>To note:</h3>
  <ul>
  <li>ASCII characters are ignored.</li>
  <li>Only the core characters from CLDR are shown (not the auxiliary), but every character that appears in a UDHR transcription is shown.</li>
  <li>Characters shown for a language include all characters produced by applying uppercase, lowercase, NFC, and NFD to the set of characters attributed to that language by its source.</li>
  <li>As mentioned above, <strong>the data is expected to be largely correct, but not 100%</strong>. There's no guarrantee that the CLDR source data is completely correct. I have already spotted some cases where changes are needed, and I hope that this tool will help spot further issues. In particular, data that is based on UDHR alone may be missing characters, just because they don't occur in that text (especially for scripts with a large syllabic repertoire). So the data should be treated with care. However, the data should be mostly correct, and I intend to fix it where errors come to light.</li>
  <li>The <samp>Native speakers</samp> row or column indicates the estimated number of <em>native</em> speakers for all the languages listed, in order to give a rough idea of the prevalence of that character. It doesn't represent the number of people who speak it as a second language, and often that is a multiple of the native speaker total. However, this number also represents speakers rather than  literate users, so they are <em>potential</em> users of the character. Depending on the language, therefore, the figures may be low or at least conservative for speakers of many languages, and possibly high for speakers of some languages (typically small languages, or when using an alternate orthography).</li>
  <li>Chinese languages, Japanese, and Korean are not listed.</li>
</ul>
</section>

<section>
  <h3>Tips:</h3>
  <ul>
  <li>Mouse over the characters displayed to see their Unicode code point value and name. The <img src="univ.png" alt="U"> icon will show all characters in that cell in UniView. This can be useful if you don't have fonts for that script, since UniView uses images by default.</li>
  <!--li> The control <samp>Find a language tag</samp> works as follows: Type in a name, or part of a name, of a language. Select the language you want from the suggestions offered. This will put the BCP47 code into the control. Hit return and you'll display information for that language.<br>
Unfortunately, this doesn't work with Safari, or (therefore)  iOS. If you need to find a BCP47 code for a language, go to <a href="https://r12a.github.io/app-subtags/">https://r12a.github.io/app-subtags/</a>.</li-->
  <li> The control <samp>Filter the list</samp> allows you to type in a name, or part of a name, of a language in order to find an option. Select the language you want from the suggestions offered. To see all options, just empty the box.<br>
Unfortunately, this doesn't work with iOS. If you need to find a BCP47 code for a language, go to <a href="https://r12a.github.io/app-subtags/">https://r12a.github.io/app-subtags/</a>.</li>
  <li>When adding characters you want to look up to the input field, you can add Unicode code point numbers with space to either side, or escapes. For example, for આ any of the following escapes will work: <code>&amp;#x0A86; \u0A86 \u{A86} \0A86 U+0A86 0xA86</code>. No extra space is needed between escapes, and supplementary characters work too.</li>
  <li>After you have generated a list of languages that use a given character, if you click on a language name then details for that language will be displayed above.</li>
  <li>You can automatically display data via the URL. For example, try <a href="https://r12a.github.io/app-charuse/?language=vi&amp;charlist=đỹã">https://r12a.github.io/app-charuse/?language=vi&amp;charlist=đỹã</a>.</li>
</ul>
</section>

<section>
  <h3>Sources:</h3>
  <ul>
  <li>CLDR: <a href="https://www.unicode.org/cldr/charts/latest/summary/root.html">https://www.unicode.org/cldr/charts/latest/summary/root.html</a></li>
  <li>UDHR: <a href="http://unicode.org/udhr/translations.html">http://unicode.org/udhr/translations.html</a></li>
  <li>r12a: mainly the articles under the heading "Script Notes" at <a href="https://r12a.github.io/doclist#scriptnotes">https://r12a.github.io/doclist#scriptnotes</a>.</li>
</ul>
</section>

<section>
<h3>To do:</h3>
  <ul>
<li>Add a graphic to show the number of speakers using a rectangle that grows with population.</li>
  <li>Show character names in HTML rather than tooltips when doing mouseover?</li>
<li>Add symbols in the relevant block that are not included in the list? (Useful for checking the data.)</li>
<li>Allow multiple regions per language for things like English, Spanish, Portuguese, etc.?</li>
  </ul>
</section>

</details>


<div class="smallprint" style="margin-right: 1em;"><span id="version">Latest commit <a href="https://github.com/r12a/app-subtags/commits/gh-pages"><span id="version-info"> 
  <!-- #BeginDate format:IS1m -->2019-06-20  8:15<!-- #EndDate --> 
	</span> GMT</a>.
	Make a <a href="https://github.com/r12a/app-subtags/issues/new">comment</a>. 
	Licence <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC-By</a> © <a href="mailto:r12a@w3.org">r12a</a></span></div>

<!--script>
// check for parameters and take appropriate action
parameters = location.search.split('&');
parameters[0] = parameters[0].substring(1);
for (var p=0;p<parameters.length;p++) {  
	pairs = parameters[p].split('=');
	if (pairs[0] == 'charlist') { if (pairs[1]) { document.getElementById('characters').value = decodeURIComponent(pairs[1]); document.getElementById('output').innerHTML = findChars(document.getElementById('characters').value); } }
	if (pairs[0] === 'language') { 
		if (pairs[1]) { 
			document.getElementById('languageSelector').value = pairs[1]
			showLanguage(pairs[1])
			}
		}
	}
</script-->



<!-- FOR RESORTING THE LANGS.JS FILE
<button onclick="sortData()">Sort data</button>
<textarea id="dump"></textarea>
<script>
function sortData () {
	var out = ''
	var keys = Object.keys(langs)
	keys.sort()
	console.log(keys)
	for (const key of keys) out += '"'+key+'":'+JSON.stringify(langs[key])+',\n\n'
	document.getElementById('dump').value = out
	}
</script-->
</body>
</html>
